<% layout('layout', { title: 'Search Users' }) %>

<div class="search-container">
  <div class="search-header">
    <h2>Search Users</h2>
    <form action="/users/search" method="GET" class="search-form">
      <input type="text" name="q" placeholder="Search by username..." value="<%= typeof query !== 'undefined' ? query : '' %>">
      <button type="submit" class="btn btn-icon">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div>
  
  <div class="search-results">
    <% if (typeof users !== 'undefined' && users.length > 0) { %>
      <% users.forEach(user => { %>
        <div class="user-card">
          <img src="<%= user.avatar %>" alt="<%= user.username %>" class="avatar">
          <div class="user-info">
            <h3><%= user.username %></h3>
            <% if (user.bio) { %>
              <p class="bio"><%= user.bio %></p>
            <% } %>
          </div>
          
          <div class="user-actions">
            <% if (currentUser.friends.includes(user._id)) { %>
              <form action="/users/remove-friend/<%= user._id %>" method="POST">
                <button type="submit" class="btn btn-outline">Remove Friend</button>
              </form>
            <% } else if (currentUser.friendRequests.includes(user._id)) { %>
              <div class="btn-group">
                <form action="/users/accept-friend/<%= user._id %>" method="POST">
                  <button type="submit" class="btn btn-primary btn-small">Accept</button>
                </form>
                <form action="/users/reject-friend/<%= user._id %>" method="POST">
                  <button type="submit" class="btn btn-outline btn-small">Reject</button>
                </form>
              </div>
            <% } else { %>
              <form action="/users/friend-request/<%= user._id %>" method="POST">
                <button type="submit" class="btn btn-primary">Add Friend</button>
              </form>
            <% } %>
          </div>
        </div>
      <% }); %>
    <% } else if (typeof query !== 'undefined') { %>
      <div class="empty-state">
        <p>No users found for "<%= query %>"</p>
      </div>
    <% } else { %>
      <div class="empty-state">
        <p>Search for users by their username</p>
      </div>
    <% } %>
  </div>
</div>
